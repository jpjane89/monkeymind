{% extends 'base.html' %}

{% block body %}

<div class="welcome-banner">
    <form class="options-form" method="POST">
      <label for="autocomplete" id= 'options-label'>Next, select the amount of time: </label>
      <input id="autocomplete" name="playlist">
      <button id="playlist-submit" class="btn btn-success">Submit</button>
    </form>
</div>

<div id="player-container">
  <div id="api"></div>
  <div id="player">
    <img id="art" src="" height="200" width="200" style="float:left;margin-right:20px;">
    <div id="player-details">
      <div><b>Track: </b><span id="track"></span></div>
      <div><b>Album: </b><span id="album"></span></div>
      <div><b>Artist: </b><span id="artist"></span></div>
      <div><b>Position: </b>
        <span style="display:inline-block;width:200px;border:1px solid black;">
          <span id="position" style="display:inline-block;background-color:#666">&nbsp;</span>
        </span></div>
      <div id="player-buttons">
        <button id="previous">&lt;&lt;</button>
        <button id="play">|&gt;</button>
        <button id="pause">||</button>
        <button id="next">&gt;&gt;</button>
      </div>
    </div>
  </div>
</div> 


<script>

function get_playback_token() {
    $.get("/ajax/getPlaybackToken", return_playback_token);
}

function return_playback_token(data) {
  sessionStorage.playbackToken = data;
}

function get_playlist_key() {
  $.get("/ajax/rdio_player", return_playlist_key);
}

function return_playlist_key(data) {
  sessionStorage.playlistKey = data;
}

function playlistMain() {

  get_playlist_key();

  $('#api').bind('ready.rdio', function() {
  // var key = sessionStorage.playlistKey.replace(/"/g,"");
    $(this).rdio().play('p10269456');
    $(this).rdio().pause();
  });

  $('#api').bind('playingTrackChanged.rdio', function(e, playingTrack, sourcePosition) {
  if (playingTrack) {
    duration = playingTrack.duration;
    $('#art').attr('src', playingTrack.icon);
    $('#track').text(playingTrack.name);
    $('#album').text(playingTrack.album);
    $('#artist').text(playingTrack.artist);
  }
  });

  $('#api').bind('positionChanged.rdio', function(e, position) {
  $('#position').css('width', Math.floor(100*position/duration)+'%');
  });

  $('#api').bind('playStateChanged.rdio', function(e, playState) {
  if (playState == 0) { // paused
    $('#play').show();
    $('#pause').hide();
  } else {
    $('#play').hide();
    $('#pause').show();
  }
  });

  get_playback_token();

  $('#api').rdio(sessionStorage.playbackToken);

  $('#previous').click(function() { $('#api').rdio().previous(); });
  $('#play').click(function() { $('#api').rdio().play(); });
  $('#pause').click(function() { $('#api').rdio().pause(); });
  $('#next').click(function() { $('#api').rdio().next(); });
}


  $(document).ready(function () {
    playlistMain();
  });

</script>
{% endblock %}


