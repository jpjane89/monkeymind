{% extends 'base.html' %}
{% block body %}

<body>
  <div id="api"></div>
  <img id="art" src="" height="200" width="200" style="float:left;margin-right:20px;">
  <div>
    <div><b>Track: </b><span id="track"></span></div>
    <div><b>Album: </b><span id="album"></span></div>
    <div><b>Artist: </b><span id="artist"></span></div>
    <div><b>Position: </b>
      <span style="display:inline-block;width:200px;border:1px solid black;">
        <span id="position" style="display:inline-block;background-color:#666">&nbsp;</span>
      </span></div>
    <div>
      <button id="previous">&lt;&lt;</button>
      <button id="play">|&gt;</button>
      <button id="pause">||</button>
      <button id="next">&gt;&gt;</button>
    </div>
  </div>

<script type="text/javascript">
    
    function get_playback_token() {
      $.get("/ajax/getPlaybackToken", return_result);
    }

    function return_result(data) {
      sessionStorage.playbackToken = data;
    }

    function main() {

      var duration = 1; // track the duration of the currently playing track

      $('#api').bind('ready.rdio', function() {
        $(this).rdio().play('a171827');
        console.log('got here')
      });

      $('#api').bind('playingTrackChanged.rdio', function(e, playingTrack, sourcePosition) {
        if (playingTrack) {
          duration = playingTrack.duration;
          $('#art').attr('src', playingTrack.icon);
          $('#track').text(playingTrack.name);
          $('#album').text(playingTrack.album);
          $('#artist').text(playingTrack.artist);
        }
        });

      $('#api').bind('positionChanged.rdio', function(e, position) {
        $('#position').css('width', Math.floor(100*position/duration)+'%');
      });
      $('#api').bind('playStateChanged.rdio', function(e, playState) {
        if (playState == 0) { // paused
          $('#play').show();
          $('#pause').hide();
        } else {
          $('#play').hide();
          $('#pause').show();
        }
      });

      get_playback_token();

      // this is a valid playback token for localhost.
      // but you should go get your own for your own domain.
      $('#api').rdio(sessionStorage.playbackToken);

      $('#previous').click(function() { $('#api').rdio().previous(); });
      $('#play').click(function() { $('#api').rdio().play(); });
      $('#pause').click(function() { $('#api').rdio().pause(); });
      $('#next').click(function() { $('#api').rdio().next(); });
    }

$(main)

</script>


<!-- // function get_playback_token() {
//   $.get("/ajax/getPlaybackToken", return_result);
// }

// function return_result(data) {
//   sessionStorage.playbackToken = data;
// }

// function callbackFn(e) {
//   console.log(e.success);
//   console.log(e.html);
// }

// function main() {

//   get_playback_token();



//   // on page load use SWFObject to load the API swf into div#apiswf
//   var params = {
//     'allowScriptAccess': 'always'
//   };

//   var attributes = {};

//   swfobject.embedSWF('http://www.rdio.com/api/swf/', 'apiswf', 1, 1, '9.0.0', 'expressInstall.swf', flashvars, params, attributes,callbackFn);

//   $('#play').click(function() {
//     apiswf.rdio_play('p10269456');
//     });

//   $('#stop').click(function() { apiswf.rdio_stop(); });
//   $('#pause').click(function() { apiswf.rdio_pause(); });
//   $('#previous').click(function() { apiswf.rdio_previous(); });
//   $('#next').click(function() { apiswf.rdio_next(); });

//   var callback_object = {};

//   callback_object.ready = function ready() {
//   // Called once the API SWF has loaded and is ready to accept method calls.

//   // find the embed/object element
//     apiswf = $('#apiswf').get(0);

//     apiswf.rdio_startFrequencyAnalyzer({
//       frequencies: '10-band',
//       period: 100
//     });

//     console.log('ready')
//   }

//   callback_object.freeRemainingChanged = function freeRemainingChanged(remaining) {
//     $('#remaining').text(remaining);
//   }

//   callback_object.playStateChanged = function playStateChanged(playState) {
//     // The playback state has changed.
//     // The state can be: 0 - paused, 1 - playing, 2 - stopped, 3 - buffering or 4 - paused.
//     $('#playState').text(playState);
//   }

//   callback_object.playingTrackChanged = function playingTrackChanged(playingTrack, sourcePosition) {
//     // The currently playing track has changed.
//     // Track metadata is provided as playingTrack and the position within the playing source as sourcePosition.
//     if (playingTrack != null) {
//       $('#track').text(playingTrack['name']);
//       $('#album').text(playingTrack['album']);
//       $('#artist').text(playingTrack['artist']);
//       $('#art').attr('src', playingTrack['icon']);
//     }
//   }

//   callback_object.playingSourceChanged = function playingSourceChanged(playingSource) {
//     // The currently playing source changed.
//     // The source metadata, including a track listing is inside playingSource.
//   }

//   callback_object.volumeChanged = function volumeChanged(volume) {
//     // The volume changed to volume, a number between 0 and 1.
//   }

//   callback_object.muteChanged = function muteChanged(mute) {
//     // Mute was changed. mute will either be true (for muting enabled) or false (for muting disabled).
//   }

//   callback_object.positionChanged = function positionChanged(position) {
//     //The position within the track changed to position seconds.
//     // This happens both in response to a seek and during playback.
//     $('#position').text(position);
//   }

//   callback_object.queueChanged = function queueChanged(newQueue) {
//     // The queue has changed to newQueue.
//   }

//   callback_object.shuffleChanged = function shuffleChanged(shuffle) {
//     // The shuffle mode has changed.
//     // shuffle is a boolean, true for shuffle, false for normal playback order.
//   }

//   callback_object.repeatChanged = function repeatChanged(repeatMode) {
//     // The repeat mode change.
//     // repeatMode will be one of: 0: no-repeat, 1: track-repeat or 2: whole-source-repeat.
//   }

//   callback_object.playingSomewhereElse = function playingSomewhereElse() {
//     // An Rdio user can only play from one location at a time.
//     // If playback begins somewhere else then playback will stop and this callback will be called.
//   }

//   callback_object.updateFrequencyData = function updateFrequencyData(arrayAsString) {
//     // Called with frequency information after apiswf.rdio_startFrequencyAnalyzer(options) is called.
//     // arrayAsString is a list of comma separated floats.

//     var arr = arrayAsString.split(',');

//     $('#freq div').each(function(i) {
//       $(this).width(parseInt(parseFloat(arr[i])*500));
//     })
//   }

// }


// $(main)
//  -->

{% endblock %}